{"meta":{"title":"Pressing Words, With Your Friend, Wordpress","slug":"wordpress-but-not-terrible","date":"2018.10.24","description":"<p>A conÂ­temÂ­poÂ­rary deÂ­velÂ­opÂ­ers guide to buildÂ­ing things on Wordpress 4.x and not havÂ­ing it be terÂ­riÂ­ble.</p>\n","collection":"texts","timestamp":1540364400000},"content":"<p>TL:DR; <a href=\"https://github.com/nikolaswise/nanobox-wordpress-1\">Start here</a>. Install <a href=\"https://nanobox.io/\">this thing</a> and conÂ­nect it to your acÂ­count on <a href=\"https://www.digitalocean.com/\">here</a>. Buy a liÂ­cense of <a href=\"https://deliciousbrains.com/wp-migrate-db-pro/\">this (itâ€™s worth it)</a>. Read some docs for <a href=\"https://www.upstatement.com/timber/\">this</a> and start buildÂ­ing. Wordpress 5 and Gutenberg will probÂ­aÂ­bly break all of this exÂ­cept the enÂ­viÂ­ronÂ­ments.</p>\n<p>When I ï¬rst started workÂ­ing as a deÂ­velÂ­oper, Wordpress was <em>the</em> prevaÂ­lent platÂ­form for pretty much any proÂ­ject. Ten years later and â€¦ Wordpress is still pretty much most of the inÂ­terÂ­net. In genÂ­eral, Wordpress will be my last choice of a platÂ­form. I preÂ­fer to build staÂ­tic sites, use a headÂ­less <span class=\"small-caps\">CMS</span>, or alÂ­most anyÂ­thing else at all.</p>\n<p>That said, as the Technical Director at Fuzzco â€” a deÂ­sign stuÂ­dio that reÂ­lies alÂ­most exÂ­cluÂ­sively on Wordpress for their webÂ­sites â€” Wordpress was hapÂ­penÂ­ing. Fuzzco is rare among stuÂ­dios in that we manÂ­age and host proÂ­jects for our clients, and ofÂ­ten have mainÂ­teÂ­nance ridÂ­ers that can last for years. This means that in the course of a year, not only did we build a half dozen new proÂ­jects on Wordpress, but we mainÂ­tained and triaged isÂ­sues on over 100 legacy proÂ­jects.</p>\n<p>Very quickly I reÂ­alÂ­ized I had one opÂ­tion: <em>make Wordpress not terÂ­riÂ­ble.</em></p>\n<h2>Terrible is pretty harsh</h2>\n<p>If youâ€™re comÂ­fortÂ­able with Wordpress, you might ï¬nd some ï¬ghtÂ­inâ€™ words here. Whatâ€™s my probÂ­lem with Wordpress and what am I tryÂ­ing to solve for? My biggest isÂ­sue with Wordpress deÂ­velÂ­opÂ­ment as Iâ€™ve enÂ­counÂ­tered it in the past is a lack of clarÂ­ity around the reÂ­quireÂ­ments of the enÂ­tire sysÂ­tem. What does the proÂ­ject need to run in an enÂ­viÂ­ronÂ­ment, and why? How do we move from a reposÂ­iÂ­tory to a loÂ­cal enÂ­viÂ­ronÂ­ment and start workÂ­ing on a codeÂ­base? How does that codeÂ­base get deÂ­ployed to a server?</p>\n<p>Iâ€™ve seen Wordpress sysÂ­tems that are frozen in time in 2006 â€” <span class=\"small-caps\">FTP</span> to the server and edit a <span class=\"small-caps\">CSS</span> ï¬le on proÂ­ducÂ­tion, or<span class=\"push-double\"></span> <span class=\"pull-double\">â€œ</span>deployâ€ your theme by upÂ­loadÂ­ing a <code>.zip</code>. Iâ€™m inÂ­terÂ­ested in how we can lower the cogÂ­niÂ­tive overÂ­head for getÂ­ting a Wordpress proÂ­ject up and runÂ­ning, and join in with pre-proÂ­cessÂ­ing, comÂ­pilÂ­ing, conÂ­tainerÂ­izÂ­ing, testÂ­ing, and all the reÂ­ally exÂ­celÂ­lent things that weâ€™ve come to exÂ­pect from our web stacks over the past few years.</p>\n<p>Another isÂ­sue I have with Wordpress is its comÂ­mitÂ­ment to auto-magÂ­iÂ­cal routes and renÂ­derÂ­ing temÂ­plates with obÂ­scure and comÂ­pliÂ­cated <code>.php</code> patÂ­terns that baÂ­siÂ­cally conÂ­cateÂ­nate strings. Iâ€™m inÂ­terÂ­ested in exÂ­plicit routes â€” eiÂ­ther hard-coded or paÂ­raÂ­meÂ­terÂ­ized â€” and sepÂ­aÂ­ratÂ­ing conÂ­cerns beÂ­tween logic and temÂ­plate.</p>\n<p>A lot of this boils down to a disÂ­agreeÂ­ment beÂ­tween what Wordpress thinks a site should be and what I end up usÂ­ing it for. Wordpress as deÂ­signed disÂ­tinÂ­guishes beÂ­tween your<span class=\"push-double\"></span> <span class=\"pull-double\">â€œ</span>siteâ€ and your<span class=\"push-double\"></span> <span class=\"pull-double\">â€œ</span>themeâ€. Your<span class=\"push-double\"></span> <span class=\"pull-double\">â€œ</span>siteâ€ is the conÂ­tent in the dataÂ­base, the opÂ­tions youâ€™ve saved, and the menus and widÂ­gets youâ€™ve inÂ­stalled. It exÂ­pects<span class=\"push-double\"></span> <span class=\"pull-double\">â€œ</span>themesâ€ to be preÂ­senÂ­taÂ­tions of this real webÂ­site stuff. This model of webÂ­sites perÂ­petÂ­uÂ­ates that<span class=\"push-double\"></span> <span class=\"pull-double\">â€œ</span>designâ€ is someÂ­thing that can be apÂ­plied over a webÂ­site, a kind of dressÂ­ing up of the real things. This is the inÂ­verse, and perÂ­haps a corolÂ­lary to, the conÂ­cept that deÂ­signÂ­ing a webÂ­site is just deÂ­cidÂ­ing what it looks like. Itâ€™s an idea that lives within the sysÂ­tem of siÂ­los beÂ­tween deÂ­sign and deÂ­velÂ­opÂ­ment, and that we can<span class=\"push-double\"></span> <span class=\"pull-double\">â€œ</span>designâ€ a webÂ­site in Photoshop or Sketch and hand off the comps to a deÂ­velÂ­oper to build it. Which is how a lot of Wordpress proÂ­jects are built.</p>\n<p>In short, <a href=\"/texts/how-to-design-while-developing/\">I disÂ­agree</a> with this conÂ­cept of webÂ­sites. My poÂ­siÂ­tion is that deÂ­signÂ­ing a webÂ­site is both how it looks, how it works, and how the data and strucÂ­tures are comÂ­posed. Taking this apÂ­proach, conÂ­trolÂ­ling the obÂ­ject modÂ­els, the inÂ­forÂ­maÂ­tion arÂ­chiÂ­tecÂ­tures, and the temÂ­plates are all of equal imÂ­porÂ­tance. In my line of work, a Wordpress theme can not be apÂ­plied to any other site than the one that it was deÂ­signed for, a site where the strucÂ­ture was deÂ­signed for the theme.</p>\n<h2>So why use Wordpress?</h2>\n<p>There are still a numÂ­ber of reÂ­ally good, comÂ­pelling reaÂ­sons to use Wordpress as a platÂ­form for buildÂ­ing webÂ­sites. Itâ€™s got a roÂ­bust built-in comÂ­mentÂ­ing sysÂ­tem with user acÂ­counts. Itâ€™s reÂ­ally good for things that are shaped like blogs. Itâ€™s got a huge, well-mainÂ­tained ecosysÂ­tem of pluÂ­gÂ­ins. Itâ€™s free. And since itâ€™s most of the Internet, clients are reÂ­ally, reÂ­ally comÂ­fortÂ­able with it.</p>\n<p>There are a couÂ­ple of reaÂ­sons <em>not</em> to use Wordpress right now. Mostly these cenÂ­ter around the imÂ­pendÂ­ing reÂ­lease of Wordpress 5.0 and the Gutenberg edÂ­iÂ­tor, which has a numÂ­ber of conÂ­cerns around pluÂ­gin comÂ­patÂ­iÂ­bilÂ­ity and acÂ­cesÂ­siÂ­bilÂ­ity for auÂ­thors.</p>\n<p>But thatâ€™s okay, since weâ€™ve deÂ­cided to use Wordpress 4.x. As we all know, pickÂ­ing a verÂ­sion of Wordpress and then never upÂ­gradÂ­ing it is one of the time honÂ­ored traÂ­diÂ­tions of Wordpress deÂ­velÂ­opÂ­ment.</p>\n<h2>How does this work even</h2>\n<p>Letâ€™s start at the end.</p>\n<p>Weâ€™re goÂ­ing to be hostÂ­ing our proÂ­ducÂ­tion Wordpress site on a <a href=\"https://www.digitalocean.com/\">Digital Ocean</a> droplet â€” the <a href=\"https://www.digitalocean.com/pricing/\">smallÂ­est</a> one they have â€” for $5 per month. Depending on the proÂ­ject lifeÂ­cyÂ­cle, we can set up more droplets for a stagÂ­ing server and a deÂ­velÂ­opÂ­ment server. At Fuzzco we used dev servers to show sites to the inÂ­terÂ­nal team, stagÂ­ing servers to show sites to the client, and proÂ­ducÂ­tion servers to show sites to the pubÂ­lic.</p>\n<p>I donâ€™t know about you, but I perÂ­sonÂ­ally donâ€™t suÂ­per love manÂ­agÂ­ing my virÂ­tual priÂ­vate servers manÂ­uÂ­ally. In orÂ­der to deÂ­ploy our codeÂ­bases to Digital Ocean weâ€™ll use the pheÂ­nomÂ­eÂ­nal tool <a href=\"https://nanobox.io/\">Nanobox</a>. Nanobox is an opÂ­erÂ­aÂ­tions layer that hanÂ­dles conÂ­tainerÂ­izÂ­ing apÂ­pliÂ­caÂ­tions and deÂ­ployÂ­ing them agÂ­nosÂ­tiÂ­cally to a cloud serÂ­vice provider. Nanobox will deÂ­ploy our code from the comÂ­mand line to any one of our droplets.</p>\n<p>Nanobox will also conÂ­tainerÂ­ize and run an apÂ­pliÂ­caÂ­tion in a virÂ­tual maÂ­chine <em>loÂ­cally</em>. This means weâ€™ll use it to run our deÂ­velÂ­opÂ­ment enÂ­viÂ­ronÂ­ment, and enÂ­sure that all of our enÂ­viÂ­ronÂ­ments are idenÂ­tiÂ­cal. No more worÂ­ryÂ­ing about <span class=\"small-caps\">PHP</span> verÂ­sions and exÂ­tenÂ­sions and pluÂ­gÂ­ins. No more runÂ­ning <span class=\"small-caps\">MAMP</span> or MySQL or Apache or whatÂ­ever on your loÂ­cal maÂ­chine beÂ­fore anyÂ­thing works. Nanobox deÂ­ï¬nes the server in a <code>.yaml</code> ï¬le, and it will alÂ­ways be the same. It also hanÂ­dles all the syncÂ­ing beÂ­tween our loÂ­cal disk and our virÂ­tual enÂ­viÂ­ronÂ­ment.</p>\n<p>So now that we know how our code is goÂ­ing from loÂ­cal to proÂ­ducÂ­tion, we can think for a secÂ­ond about <em>how</em> itâ€™s goÂ­ing to do that, and how weâ€™re goÂ­ing to manÂ­age our data.</p>\n<p>The dataÂ­base on the proÂ­ducÂ­tion server is<span class=\"push-double\"></span> <span class=\"pull-double\">â€œ</span>canonicalâ€. That means that the dataÂ­base the client inÂ­terÂ­acts with is the one true dataÂ­base, and we must treat it with care and atÂ­tenÂ­tion. Weâ€™ll never change that dataÂ­base ourÂ­selves, and weâ€™ll move that dataÂ­base <em>downÂ­stream</em> from proÂ­ducÂ­tion to stagÂ­ing to dev to loÂ­cal in orÂ­der to deÂ­velop against our real data. Importantly, we donâ€™t want to miÂ­grate the dataÂ­base manÂ­uÂ­ally eiÂ­ther. Itâ€™s a litÂ­tle exÂ­penÂ­sive but usÂ­ing <a href=\"https://deliciousbrains.com/wp-migrate-db-pro/pricing/\">Migrate <span class=\"small-caps\">DB</span> Pro</a> is an inÂ­credÂ­iÂ­ble reÂ­source for this part. I guess one could also look into <a href=\"https://github.com/wp-sync-db/wp-sync-db\">alÂ­terÂ­naÂ­tives</a> for perÂ­sonal proÂ­jects.</p>\n<p>The canonÂ­iÂ­cal <em>codeÂ­base</em> lives in verÂ­sion conÂ­trol, and moves the other diÂ­recÂ­tion. From Github to loÂ­cal to dev to stagÂ­ing to proÂ­ducÂ­tion, amen. The only things we need to track in verÂ­sion conÂ­trol are what makes our proÂ­ject unique. Practically, this means we need to track our theme and our pluÂ­gÂ­ins. Wordpress core ï¬les are not speÂ­cial, and we should not ï¬ll our reposÂ­iÂ­toÂ­ries with them.</p>\n<h2>Getting started</h2>\n<p>At this point itâ€™s worth <a href=\"https://docs.nanobox.io/install/\">getÂ­ting started with Nanobox</a>. I back the conÂ­tainÂ­ers with <a href=\"https://docs.nanobox.io/install/#lightweight-vm-virtualbox\">VirtualBox</a>, since at the time I started this it was slightly more staÂ­ble than Docker on MacOS High Sierra. Once Nanobox &amp; Virtualbox/Docker is inÂ­stalled, set up <a href=\"https://docs.nanobox.io/providers/hosting-accounts/digitalocean/\">Digital Ocean as your provider</a>. Once thatâ€™s done, we have everyÂ­thing we need to get started!</p>\n<p>Iâ€™ll be talkÂ­ing through a proÂ­ject I built in orÂ­der to faÂ­cilÂ­iÂ­tate buildÂ­ing other proÂ­jects. This will be more inÂ­tense than you might need for a sinÂ­gle build, but this was deÂ­signed a tool that anyÂ­one can use to get started quickly. Hereâ€™s the baÂ­sic strucÂ­ture of our repo:</p>\n<pre><code>ğŸ“ <span class=\"hljs-string\">/project-name</span>\nâ®‘ ğŸ“„ <span class=\"hljs-string\">.gitignore</span>    <span class=\"hljs-comment\"># includes /wp</span>\nâ®‘ ğŸ“„ package.json  <span class=\"hljs-comment\"># tooling lives here</span>\nâ®‘ ğŸ“„ readme.md     <span class=\"hljs-comment\"># be nice, write docs    </span>\nâ®‘ ğŸ“ theme         <span class=\"hljs-comment\"># our theme codebase</span>\nâ®‘ ğŸ“ plugins       <span class=\"hljs-comment\"># vendor plugins</span>\nâ®‘ ğŸ“ scripts       <span class=\"hljs-comment\"># some helpers</span>\n</code></pre>\n<p>The crux of the proÂ­ject is our <code>boxfile.yml</code> conÂ­ï¬gÂ­uÂ­raÂ­tion ï¬le. This is what Nanobox uses to creÂ­ate our conÂ­tainÂ­ers. It looks like this!</p>\n<pre><code><span class=\"hljs-comment\"># /boxfile.yml                </span>\n<span class=\"hljs-attr\">run.config:</span>                    <span class=\"hljs-comment\"># </span>\n  <span class=\"hljs-attr\">engine:</span> <span class=\"hljs-string\">php</span>                  <span class=\"hljs-comment\">#</span>\n  <span class=\"hljs-attr\">engine.config:</span>               <span class=\"hljs-comment\">#</span>\n    <span class=\"hljs-attr\">runtime:</span> <span class=\"hljs-string\">php-7.0</span>           <span class=\"hljs-comment\"># Defines PHP version</span>\n    <span class=\"hljs-attr\">document_root:</span> <span class=\"hljs-string\">&#x27;wp/&#x27;</span>       <span class=\"hljs-comment\"># Dir to serve app from</span>\n    <span class=\"hljs-attr\">extensions:</span>                <span class=\"hljs-comment\"># PHP extensions we need</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">gd</span>                     <span class=\"hljs-comment\">#</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">mysqli</span>                 <span class=\"hljs-comment\">#</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">curl</span>                   <span class=\"hljs-comment\">#</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">zlib</span>                   <span class=\"hljs-comment\">#</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">ctype</span>                  <span class=\"hljs-comment\">#</span>\n                               <span class=\"hljs-comment\">#</span>\n<span class=\"hljs-attr\">web.wp:</span>                        <span class=\"hljs-comment\">#</span>\n  <span class=\"hljs-attr\">start:</span> <span class=\"hljs-string\">php-server</span>            <span class=\"hljs-comment\">#</span>\n  <span class=\"hljs-attr\">network_dirs:</span>                <span class=\"hljs-comment\">#</span>\n    <span class=\"hljs-attr\">data.storage:</span>              <span class=\"hljs-comment\">#</span>\n      <span class=\"hljs-bullet\">-</span> <span class=\"hljs-string\">wp/wp-content/uploads/</span> <span class=\"hljs-comment\">#</span>\n<span class=\"hljs-attr\">data.db:</span>                       <span class=\"hljs-comment\">#</span>\n  <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">nanobox/mysql:5.6</span>     <span class=\"hljs-comment\"># Nanobox DB magic</span>\n                               <span class=\"hljs-comment\">#</span>\n<span class=\"hljs-attr\">data.storage:</span>                  <span class=\"hljs-comment\">#</span>\n  <span class=\"hljs-attr\">image:</span> <span class=\"hljs-string\">nanobox/unfs:0.9</span>      <span class=\"hljs-comment\">#</span>\n</code></pre>\n<p>As noted above, weâ€™ll be servÂ­ing our enÂ­tire inÂ­stalÂ­laÂ­tion of Wordpress in the <code>/wp</code> diÂ­recÂ­tory. This will hold all the Wordpress core ï¬les and comÂ­piled theme code, none of of which we need or want in verÂ­sion conÂ­trol. As such, make sure this is listed alongÂ­side <code>node_modules</code> in the <code>.gitignore</code>.</p>\n<p>Since weâ€™ve deÂ­cided that we donâ€™t want to track these ï¬les, but we need them to acÂ­tuÂ­ally have a proÂ­ject, we can write a helper script to take care of the gap beÂ­tween those two ideas.</p>\n<p>Here are the scripts weâ€™re goÂ­ing to write to help us hanÂ­dle this process:</p>\n<pre><code>ğŸ“ /<span class=\"hljs-keyword\">project</span>-name\nâ®‘ ğŸ“ scripts\n   â®‘ ğŸ“„ check-<span class=\"hljs-keyword\">install</span>.sh <span class=\"hljs-comment\"># Installs Wordpress core files.</span>\n   â®‘ ğŸ“„ init.sh          <span class=\"hljs-comment\"># Runs our setup helper.</span>\n   â®‘ ğŸ“„ prestart.sh      <span class=\"hljs-comment\"># Checks if we need to init.</span>\n   â®‘ ğŸ“„ setup.js         <span class=\"hljs-comment\"># Cute lil&#x27; CLI helper.</span>\n</code></pre>\n<p>The ï¬rst thing weâ€™ll do is write a script that checks if <code>/wp</code> exÂ­ists. If it doesÂ­nâ€™t, throw an erÂ­ror that we need to iniÂ­tialÂ­ize the proÂ­ject since we donâ€™t have any of the core ï¬les we need.</p>\n<pre><code><span class=\"hljs-comment\"># prestart.sh</span>\n<span class=\"hljs-comment\">#!/bin/bash</span>\necho <span class=\"hljs-string\">&#x27;Check to make sure wordpress is here at all&#x27;</span>\n<span class=\"hljs-keyword\">if</span> test -d .<span class=\"hljs-regexp\">/wp/</span>\nthen\n  echo <span class=\"hljs-string\">&#x27;yup we good&#x27;</span>\n  <span class=\"hljs-keyword\">exit</span> <span class=\"hljs-number\">0</span>\n<span class=\"hljs-keyword\">else</span>\n  echo <span class=\"hljs-string\">&#x27;Project not initialized: Run `$ npm run init`&#x27;</span>\n  <span class=\"hljs-keyword\">exit</span> <span class=\"hljs-number\">1</span>\nfi\n</code></pre>\n<p>Iâ€™m callÂ­ing this <code>prestart</code> beÂ­cause I want to run it beÂ­fore <code>npm start</code>. Many times Iâ€™ll be on auÂ­topiÂ­lot, and afÂ­ter cloning a repo simÂ­ply run <code>npm install</code> and <code>npm start</code>. This inÂ­terÂ­rupts that process and lets me know I need a third step, <code>npm run init</code>. Letâ€™s put this in our <code>package.json</code> scripts:</p>\n<pre><code><span class=\"hljs-comment\"># package.json</span>\n{\n  <span class=\"hljs-string\">...</span>\n  <span class=\"hljs-string\">&quot;scripts&quot;</span>: {\n    <span class=\"hljs-string\">...</span>\n    <span class=\"hljs-string\">&quot;init&quot;</span>: <span class=\"hljs-string\">&quot;./scripts/init.sh&quot;</span>,\n    <span class=\"hljs-string\">&quot;prestart&quot;</span>: <span class=\"hljs-string\">&quot;./scripts/prestart.sh&quot;</span>,\n    <span class=\"hljs-string\">&quot;start&quot;</span>: <span class=\"hljs-string\">&quot;npm run dev&quot;</span>\n  }\n  <span class=\"hljs-string\">...</span>\n}\n</code></pre>\n<p>Weâ€™ll get to our dev toolÂ­ing later. Lets take a look at what our <code>init.sh</code> script does:</p>\n<pre><code><span class=\"hljs-comment\"># init.sh</span>\n<span class=\"hljs-comment\">#!/bin/bash</span>\n<span class=\"hljs-keyword\">node</span> <span class=\"hljs-title\">./scripts</span>/setup.js  \n</code></pre>\n<p>Not much! This just runs our setup <span class=\"small-caps\">CLI</span> helper. You might not need all this, but since I built this sysÂ­tem to help a team of deÂ­velÂ­opÂ­ers work on <em>many many</em> proÂ­jects youâ€™re gonna get it anyÂ­way.</p>\n<pre><code><span class=\"hljs-comment\">// setup.js</span>\n\n<span class=\"hljs-comment\">// some nice deps for making a CLI.</span>\n<span class=\"hljs-keyword\">const</span> prompt = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&#x27;prompt&#x27;</span>)\n<span class=\"hljs-keyword\">const</span> exec = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&#x27;child_process&#x27;</span>).exec\n<span class=\"hljs-keyword\">const</span> colors = <span class=\"hljs-built_in\">require</span>(<span class=\"hljs-string\">&quot;colors/safe&quot;</span>)\n\n<span class=\"hljs-comment\">// Run and log a bash command</span>\n<span class=\"hljs-keyword\">const</span> bash = <span class=\"hljs-function\"><span class=\"hljs-params\">cmd</span> =&gt;</span> {\n  msg(<span class=\"hljs-string\">&#x27;green&#x27;</span>, <span class=\"hljs-string\">`Running: <span class=\"hljs-subst\">${cmd}</span>`</span>)\n  <span class=\"hljs-keyword\">return</span> <span class=\"hljs-keyword\">new</span> <span class=\"hljs-built_in\">Promise</span>(<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">resolve, reject</span>) </span>{\n    exec(cmd, <span class=\"hljs-function\">(<span class=\"hljs-params\">err, stdout, stderr</span>) =&gt;</span> {\n      <span class=\"hljs-keyword\">if</span> (err) reject(err)\n      resolve(stdout, stderr)\n    })\n  });\n}\n\n<span class=\"hljs-comment\">// Log a message</span>\n<span class=\"hljs-keyword\">const</span> msg = <span class=\"hljs-function\">(<span class=\"hljs-params\">color, text</span>) =&gt;</span> {\n  <span class=\"hljs-built_in\">console</span>.log(colors[color](text))\n}\n\n<span class=\"hljs-comment\">// do the magic</span>\n<span class=\"hljs-keyword\">const</span> setup = <span class=\"hljs-function\">(<span class=\"hljs-params\">err, result</span>) =&gt;</span> {\n  <span class=\"hljs-keyword\">if</span> (err) msg(<span class=\"hljs-string\">`red`</span>, err)\n\n  msg(<span class=\"hljs-string\">&#x27;yellow&#x27;</span>, <span class=\"hljs-string\">&#x27;WordPress configuration values â˜Ÿ&#x27;</span>)\n\n  <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">let</span> key <span class=\"hljs-keyword\">in</span> result) {\n    msg(<span class=\"hljs-string\">&#x27;yellow&#x27;</span>, <span class=\"hljs-string\">`<span class=\"hljs-subst\">${key}</span>: <span class=\"hljs-subst\">${result[key]}</span>;`</span>)\n  }\n  <span class=\"hljs-comment\">// run our check-install script.</span>\n  bash(<span class=\"hljs-string\">`<span class=\"hljs-subst\">${process.cwd()}</span>/scripts/check-install.sh`</span>)\n  .then(<span class=\"hljs-function\"><span class=\"hljs-params\">ok</span> =&gt;</span> {\n    <span class=\"hljs-comment\">// add our project to hostfile</span>\n    bash(<span class=\"hljs-string\">`nanobox dns add local <span class=\"hljs-subst\">${result.name}</span>.local`</span>)\n  })\n  .then(<span class=\"hljs-function\"><span class=\"hljs-params\">ok</span> =&gt;</span> {\n    <span class=\"hljs-comment\">// explain the next step</span>\n    msg(<span class=\"hljs-string\">&#x27;green&#x27;</span>, <span class=\"hljs-string\">`Run npm start, then finish setting up WordPress at <span class=\"hljs-subst\">${result.name}</span>.local/wp-admin`</span>)\n  })\n}\n\nmsg(<span class=\"hljs-string\">&#x27;green&#x27;</span>, <span class=\"hljs-string\">&#x27;Making Progress!&#x27;</span>)\nprompt.start();\nprompt.get({\n  <span class=\"hljs-attr\">properties</span>: {\n    <span class=\"hljs-attr\">name</span>: {\n      <span class=\"hljs-attr\">description</span>: colors.magenta(<span class=\"hljs-string\">&quot;Project name:&quot;</span>)\n    }\n  }\n}, setup);\n</code></pre>\n<p>This will open a <span class=\"small-caps\">CLI</span> askÂ­ing for the name of the proÂ­ject, run the <code>check-install.sh</code> script, creÂ­ate the hostÂ­ï¬le line for our loÂ­cal <span class=\"small-caps\">DNS</span> at <code>&lt;project-name&gt;.local</code>, and log the next acÂ­tion that you need to take to ï¬nÂ­ish inÂ­stalling Wordpress.</p>\n<p>Lets take a peek at our <code>check-install.sh</code> ï¬le:</p>\n<pre><code><span class=\"hljs-comment\"># check-install.sh</span>\n<span class=\"hljs-comment\">#!/bin/bash</span>\necho <span class=\"hljs-string\">&#x27;Check to make sure wordpress is here at all&#x27;</span>\n<span class=\"hljs-keyword\">if</span> test -d .<span class=\"hljs-regexp\">/wp/</span>\nthen\n  echo <span class=\"hljs-string\">&#x27;yup we good&#x27;</span>\n<span class=\"hljs-keyword\">else</span>\n  echo <span class=\"hljs-string\">&#x27;nope we need that&#x27;</span>\n  degit git@github.com:nanobox-quickstarts/nanobox-wordpress.git wp\nfi\nrsync -va --<span class=\"hljs-keyword\">delete</span> .<span class=\"hljs-regexp\">/plugins/</span> .<span class=\"hljs-regexp\">/wp/</span>wp-content<span class=\"hljs-regexp\">/plugins/</span>\nrsync -va --<span class=\"hljs-keyword\">delete</span> .<span class=\"hljs-regexp\">/theme/</span> .<span class=\"hljs-regexp\">/wp/</span>wp-content<span class=\"hljs-regexp\">/themes/my</span>-theme\n</code></pre>\n<p>Very simÂ­iÂ­lar to <code>prestart</code>! The biggest difÂ­ferÂ­ence is the bit where we use <code>degit</code> to clone Nanoboxâ€™s ofÂ­ï¬Â­cial Wordpress repo into our unÂ­tracked <code>/wp</code> diÂ­recÂ­tory. Degit will only get the head ï¬les, and none of the git hisÂ­tory. Nor will it keep the <code>.git</code> ï¬le, baÂ­siÂ­cally makÂ­ing this a suÂ­per clean, suÂ­per fast way to downÂ­load a diÂ­recÂ­tory of ï¬les. Itâ€™s great. The last thing this does is wipe out any themes or pluÂ­gÂ­ins that we donâ€™t want our need in the core ï¬les and syncs out own tracked diÂ­recÂ­toÂ­ries to the corÂ­rect places in the Wordpress core ï¬le strucÂ­ture.</p>\n<p>Now would be a time to talk about pluÂ­gÂ­ins.</p>\n<h2>Whatâ€™s up with pluÂ­gÂ­ins?</h2>\n<p>Wordpress has a milÂ­lion pluÂ­gÂ­ins. Weâ€™re goÂ­ing to foÂ­cus on some of the baÂ­sic ones that alÂ­most every Wordpress proÂ­ject ever needs, and should honÂ­estly be part of Wordpress. Building sites withÂ­out these is a pain. Here they are:</p>\n<pre><code>ğŸ“ /project-name\nâ®‘ ğŸ“ plugins\n  â®‘ ğŸ“ advanced-custom-fields-<span class=\"hljs-keyword\">pro</span>\n  â®‘ ğŸ“ custom-<span class=\"hljs-keyword\">post</span>-types-ui\n  â®‘ ğŸ“ timber-library\n  â®‘ ğŸ“ wp-migrate-<span class=\"hljs-keyword\">db</span>-<span class=\"hljs-keyword\">pro</span>\n</code></pre>\n<p>There are a couÂ­ple more in my repo to do things like orÂ­der posts in the <span class=\"small-caps\">CMS</span> and imÂ­port CSVs. Not suÂ­per necÂ­esÂ­sary, so we wonâ€™t talk about theme here.</p>\n<h3>Advanced Custom Fields</h3>\n<p><a href=\"https://www.advancedcustomfields.com/\"><span class=\"small-caps\">ACF</span></a> is a staÂ­ple of Wordpress deÂ­velÂ­opÂ­ment. It lets us deÂ­ï¬ne new key/â€‹value pairs to exÂ­tend the data model of things like posts and pages, and alÂ­lows us to creÂ­ate a set of global variÂ­able availÂ­able from anyÂ­where. Sounds simÂ­ple, surÂ­prisÂ­ing itâ€™s not part of Wordpress.</p>\n<h3>Custom Post Types <span class=\"small-caps\">UI</span></h3>\n<p><a href=\"https://wordpress.org/plugins/custom-post-type-ui/\">CPT-UI</a> creÂ­ates an inÂ­terÂ­face in the adÂ­min panel for creÂ­atÂ­ing new post types. Out of the box, Wordpress comes with <code>Posts</code> and <code>Pages</code>. CPT-UI lets us build new types like <code>Projects</code> or <code>Case Studies</code> or whatÂ­ever need for our data model. Again, surÂ­prisÂ­ing that this  isÂ­nâ€™t just part of Wordpress. Câ€™est la vivre.</p>\n<h3><span class=\"small-caps\">WP</span> Migrate <span class=\"small-caps\">DB</span></h3>\n<p><a href=\"https://deliciousbrains.com/wp-migrate-db-pro/\">Migrate <span class=\"small-caps\">DB</span></a> lets us â€¦ miÂ­grate â€¦ our â€¦ <span class=\"small-caps\">DB</span>. This gives us the abilÂ­ity to sync our dataÂ­bases across enÂ­viÂ­ronÂ­ments and get meÂ­dia upÂ­loads and things withÂ­out needÂ­ing to write magic MySQL queries while tunÂ­neled into open dataÂ­base ports on virÂ­tual maÂ­chines. This is betÂ­ter. Believe me.</p>\n<h3>Timber</h3>\n<p>The <a href=\"https://www.upstatement.com/timber/\">Timber</a> liÂ­brary from Upstatement is the greatÂ­est thing to hapÂ­pen to Wordpress deÂ­velÂ­opÂ­ment, afÂ­ter those pluÂ­gÂ­ins that should just be part of Wordpress. Timber inÂ­troÂ­duces the conÂ­cept of <em>layÂ­out temÂ­plates</em> to Wordpress. This lets us write <span class=\"small-caps\">PHP</span> to maÂ­nipÂ­uÂ­late data, and pass that data to a temÂ­plate ï¬le where we can write <a href=\"https://twig.symfony.com/\">Twig temÂ­plates</a> rather than comÂ­posÂ­ing strings in <span class=\"small-caps\">PHP</span>. Basically â€¦</p>\n<pre><code><span class=\"hljs-meta\">&lt;?php</span> <span class=\"hljs-keyword\">echo</span> $myvar <span class=\"hljs-meta\">?&gt;</span>\n</code></pre>\n<p>Turns in to:</p>\n<p>{% raw %}</p>\n<pre><code><span class=\"hljs-template-variable\">{{ <span class=\"hljs-name\">myvar</span> }}</span><span class=\"xml\">\n</span></code></pre>\n<p>{% enÂ­draw %}</p>\n<p>This lets us write temÂ­plates with a temÂ­platÂ­ing lanÂ­guage, and write server-side busiÂ­ness logic in a server-side proÂ­gramÂ­ming lanÂ­guage. Truly revÂ­oÂ­luÂ­tionÂ­ary.</p>\n<h2>What we talk about when we talk about Wordpress deÂ­velÂ­opÂ­ment: or, The Theme.</h2>\n<p>With all this iniÂ­tial work around Wordpress core, deÂ­velÂ­opÂ­ment enÂ­viÂ­ronÂ­ments, and a baÂ­sic pluÂ­gin ecosysÂ­tem in place we can start talkÂ­ing about the good stuff: the theme!</p>\n<pre><code>ğŸ“ /project-name\nâ®‘ ğŸ“ theme\n   â®‘ ğŸ“ es6              # Source JS\n   â®‘ ğŸ“ scss             # Source SCSS\n   â®‘ ğŸ“ routes           # PHP<span class=\"hljs-built_in\"> route </span>logic files\n      â®‘ ğŸ“„ index.php\n      â®‘ ğŸ“„ page.php\n      â®‘ ğŸ“„ post.php\n   â®‘ ğŸ“ views            # Twig templates\n      â®‘ ğŸ“ layouts\n      â®‘ ğŸ“ pages\n      â®‘ ğŸ“ partials\n   â®‘ ğŸ“„ functions.php    # This includes routing.\n   â®‘ ğŸ“„ screenshot.png   # Theme preview image.\n   â®‘ ğŸ“„ index.php        # Need this, but it<span class=\"hljs-string\">&#x27;s empty.Â¯\\_(ãƒ„)_/Â¯\n</span></code></pre>\n<p>We wonâ€™t get too deep into this, since weâ€™re getÂ­ting into more conÂ­venÂ­tional terÂ­riÂ­tory here. Basically our <code>es6</code> diÂ­recÂ­tory holds source <span class=\"small-caps\">JS</span> that will get comÂ­piled into a bunÂ­dle. Same with the <code>scss</code> diÂ­recÂ­tory, which gets comÂ­piled into css. We hanÂ­dle that with npm scripts in the <code>package.json</code>.</p>\n<pre><code><span class=\"hljs-comment\"># package.json</span>\n{\n  <span class=\"hljs-string\">...</span>\n  <span class=\"hljs-string\">&quot;scripts&quot;</span>: {\n    <span class=\"hljs-string\">...</span>\n    <span class=\"hljs-string\">&quot;css&quot;</span>: <span class=\"hljs-string\">&quot;node-sass ./theme/scss/style.scss theme/style.css --watch&quot;</span>,\n    <span class=\"hljs-string\">&quot;js&quot;</span>: <span class=\"hljs-string\">&quot;rollup -c -w&quot;</span>,\n    <span class=\"hljs-string\">...</span>\n  }\n  <span class=\"hljs-string\">...</span>\n}\n</code></pre>\n<p>Hopefully none of this is to unÂ­usual â€” if itâ€™s is I recÂ­omÂ­mend readÂ­ing Paul Pedersonâ€™s <a href=\"http://paulcpederson.com/articles/npm-run/\">exÂ­celÂ­lent arÂ­tiÂ­cle on npm scripts</a>.</p>\n<p>There is one part of this I want to touch on beÂ­fore movÂ­ing on:</p>\n<pre><code><span class=\"hljs-comment\"># package.json</span>\n{\n  <span class=\"hljs-string\">...</span>\n  <span class=\"hljs-string\">&quot;scripts&quot;</span>: {\n    <span class=\"hljs-string\">...</span>\n    <span class=\"hljs-string\">&quot;sync:plugins&quot;</span>: <span class=\"hljs-string\">&quot;rsync -va --delete ./plugins/ ./wp/wp-content/plugins/&quot;</span>,\n    <span class=\"hljs-string\">&quot;sync:theme&quot;</span>: <span class=\"hljs-string\">&quot;rsync -va --delete ./theme/ ./wp/wp-content/themes/fuzzco&quot;</span>,    \n    <span class=\"hljs-string\">&quot;watch&quot;</span>: <span class=\"hljs-string\">&quot;rerun-script&quot;</span>,\n    <span class=\"hljs-string\">...</span>\n  },\n  <span class=\"hljs-string\">&quot;watches&quot;</span>: {\n    <span class=\"hljs-string\">&quot;sync:plugins&quot;</span>: <span class=\"hljs-string\">&quot;plugins/**/*.*&quot;</span>,\n    <span class=\"hljs-string\">&quot;sync:theme&quot;</span>: <span class=\"hljs-string\">&quot;theme/**/*.*&quot;</span>\n  },\n  <span class=\"hljs-string\">...</span> \n</code></pre>\n<p>This bit sets up a watcher on our <code>theme</code> and <code>plugins</code> diÂ­recÂ­tory, which sync our tracked workÂ­ing ï¬les to the corÂ­rect place in our Wordpress core ï¬le strucÂ­ture.</p>\n<h2>Functions, Routes, and Views</h2>\n<p>The last thing I want to touch on is the baÂ­sic strucÂ­ture of usÂ­ing Timber to match routes with views.</p>\n<pre><code><span class=\"hljs-comment\">/** functions.php */</span>\nRoutes::map(<span class=\"hljs-string\">&#x27;/&#x27;</span>, <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">$params</span>)</span>{\n  Routes::load(<span class=\"hljs-string\">&#x27;routes/page.php&#x27;</span>, $params, <span class=\"hljs-literal\">null</span>, <span class=\"hljs-number\">200</span>);\n});\nRoutes::map(<span class=\"hljs-string\">&#x27;/:page&#x27;</span>, <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> (<span class=\"hljs-params\">$params</span>) </span>{\n  $page = get_page_by_path($params[<span class=\"hljs-string\">&#x27;page&#x27;</span>]);\n  <span class=\"hljs-keyword\">if</span> ($page) {\n      Routes::load(<span class=\"hljs-string\">&#x27;routes/page.php&#x27;</span>, $params, <span class=\"hljs-literal\">null</span>, <span class=\"hljs-number\">200</span>);\n  } <span class=\"hljs-keyword\">else</span> {\n      Routes::load(<span class=\"hljs-string\">&#x27;routes/404.php&#x27;</span>, $params, <span class=\"hljs-literal\">null</span>, <span class=\"hljs-number\">404</span>);\n  }\n});\nRoutes::map(<span class=\"hljs-string\">&#x27;/blog/:post&#x27;</span>, <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span>(<span class=\"hljs-params\">$params</span>)</span>{\n  Routes::load(<span class=\"hljs-string\">&#x27;routes/post.php&#x27;</span>, $params, <span class=\"hljs-literal\">null</span>, <span class=\"hljs-number\">200</span>);\n});\n</code></pre>\n<p>These are Timber routes deÂ­ï¬ned in the <code>functions.php</code> ï¬le. This reÂ­places the stanÂ­dard routÂ­ing of Wordpress, and we have change the strucÂ­ture of the Wordpress permaÂ­links to anyÂ­thing other than the deÂ­fault to have it work. This is docÂ­uÂ­mented in Timber.</p>\n<p>When our server gets a reÂ­quest at a route of <code>/page-name</code>, it will call the <code>page.php</code> ï¬le and pass it the params asÂ­soÂ­ciÂ­ated with the route.</p>\n<pre><code><span class=\"hljs-comment\">/** page.php */</span>\n<span class=\"hljs-meta\">&lt;?php</span>\n  $context = Timber::get_context();\n  $post = <span class=\"hljs-keyword\">new</span> TimberPost();\n  $context[<span class=\"hljs-string\">&#x27;page&#x27;</span>] = $post;\n  \n  Timber::render( <span class=\"hljs-keyword\">array</span>(\n    <span class=\"hljs-string\">&#x27;views/pages/page-&#x27;</span> . $post-&gt;post_name . <span class=\"hljs-string\">&#x27;.twig&#x27;</span>,\n    <span class=\"hljs-string\">&#x27;views/pages/page.twig&#x27;</span>\n  ), $context );\n<span class=\"hljs-meta\">?&gt;</span>\n</code></pre>\n<p>The <code>page.php</code> ï¬le asÂ­signs some variÂ­ables, inÂ­terÂ­acts with Wordpress to get and shape our data, and then renÂ­ders the twig ï¬le asÂ­soÂ­ciÂ­ated with the page. In this case, itâ€™s goÂ­ing to see if thereâ€™s a temÂ­plate that matches the name of our page, othÂ­erÂ­wise it will renÂ­der the deÂ­fault page temÂ­plate.</p>\n<h2>Back to the beÂ­ginÂ­ning</h2>\n<p>Youâ€™ve built your theme! Maybe itâ€™s a simÂ­ple hello world, maybe itâ€™s a heavy duty big olâ€™ thing. Either way, itâ€™s time to deÂ­ploy.</p>\n<p>You can use Nanobox to creÂ­ate a droplet for your server. Nanobox will give your proÂ­ject a name in their sysÂ­tem, and exÂ­pose the <span class=\"small-caps\">URL</span> for the server at <code>&lt;your-project&gt;.nanoapp.io</code>. I like to use the conÂ­venÂ­tion <code>project-dev</code>, <code>project-stage</code>, and <code>project-prod</code>. Once you creÂ­ate your proÂ­ject in Nanobox, the hard part is over and you can let them do the heavy liftÂ­ing:</p>\n<pre><code>$ nanobox deploy <span class=\"hljs-keyword\">project</span>-dev\n</code></pre>\n<p>Or we can map this to our <span class=\"small-caps\">NPM</span> script:</p>\n<pre><code>$ npm <span class=\"hljs-keyword\">run</span><span class=\"bash\"> deploy:dev  </span>\n</code></pre>\n<p>This will conÂ­tainerÂ­ize our apÂ­pliÂ­caÂ­tion, push it to our droplet, hyÂ­drate the enÂ­tire thing, and serve! Now we can use Migrate <span class=\"small-caps\">DB</span> to move our dataÂ­base around, and weâ€™re in busiÂ­ness.</p>\n<h2>Putting it all toÂ­gether</h2>\n<p><a href=\"https://github.com/nikolaswise/nanobox-sapper-1\">The proÂ­ject repo</a> is a turnkey, ready to roll verÂ­sion of all the above. It conÂ­tains all the toolÂ­ing needed to get started, and if youâ€™ve folÂ­lowed along with this guide, you should be able to get started in no time.</p>\n<p>As alÂ­ways, feel free to reach out to me in your venue of choice to talk about any of this â€” I would be happy to help you set this up for your own Wordpress proÂ­ject!</p>\n"}